#! /bin/bash
#SBATCH -A TG-ASC120003
#SBATCH -p development
#SBATCH -t 0:20:0
#SBATCH -N 1 -n 1
#SBATCH -J mpi-rpc
#SBATCH --mail-type=ALL
#SBATCH -o /work/00507/eschnett/src/cc/mpi-rpc/matbench.out
#SBATCH -e /work/00507/eschnett/src/cc/mpi-rpc/matbench.err

source /work/00507/eschnett/q/boost-1.55.0/env.sh
source /work/00507/eschnett/q/gperftools-2.1/env.sh
source /work/00507/eschnett/q/hwloc-1.8/env.sh
source /work/00507/eschnett/q/llvm-3.4/env.sh
source /work/00507/eschnett/q/openmpi-1.7.3/env.sh
source /work/00507/eschnett/q/qthreads-1.10/env.sh

cd /work/00507/eschnett/src/cc/mpi-rpc

# -x CPUPROFILE=matbench.prof
# mpirun -np 1 -x QTHREAD_NUM_SHEPHERDS=1 -x QTHREAD_NUM_WORKERS_PER_SHEPHERD=16 ./matbench
mpirun -np 1 -x QTHREAD_NUM_SHEPHERDS=2 -x QTHREAD_NUM_WORKERS_PER_SHEPHERD=8 ./matbench
